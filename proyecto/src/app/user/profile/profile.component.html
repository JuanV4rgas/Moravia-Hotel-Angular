<div class="profile-header text-center py-4 bg-light border-bottom">
  <img
    [src]="
      usuario.fotoPerfil ||
      'https://via.placeholder.com/280x280.png?text=' +
        usuario.nombre[0] +
        '+' +
        usuario.apellido[0]
    "
    [alt]="'Foto de perfil de ' + usuario.nombre"
    class="profile-avatar mb-3"
  />
  <h1 class="profile-name">{{ usuario.nombre }} {{ usuario.apellido }}</h1>
  <p class="profile-username">@{{ usuario.email.split("@")[0] }}</p>

  <div class="mt-3">
    <span
      class="badge"
      [ngClass]="{
        'bg-success text-white': !formChanged,
        'bg-warning text-dark': formChanged
      }"
    >
      <i
        class="bi"
        [ngClass]="formChanged ? 'bi-pencil' : 'bi-person-check'"
      ></i>
      {{ formChanged ? "Modificando" : "Perfil de Usuario" }}
    </span>
  </div>
</div>

<main class="container pb-5">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10">
      <div class="card profile-card p-4 mt-4">
        <!-- Mensajes -->
        <div
          *ngIf="mensaje"
          class="alert alert-success alert-dismissible fade show"
        >
          {{ mensaje }}
          <button
            type="button"
            class="btn-close"
            (click)="mensaje = ''"
          ></button>
        </div>
        <div
          *ngIf="error"
          class="alert alert-danger alert-dismissible fade show"
        >
          {{ error }}
          <button type="button" class="btn-close" (click)="error = ''"></button>
        </div>

        <form [formGroup]="perfilForm" (ngSubmit)="onSubmit()" novalidate>
          <!-- Información Personal -->
          <section class="mb-4">
            <h4 class="section-title">
              <i class="bi bi-person me-2"></i> Información Personal
            </h4>
            <div class="row g-3">
              <div class="col-md-6">
                <label for="nombre" class="form-label">Nombres *</label>
                <input
                  type="text"
                  class="form-control"
                  id="nombre"
                  formControlName="nombre"
                  required
                />
              </div>

              <div class="col-md-6">
                <label for="apellido" class="form-label">Apellidos *</label>
                <input
                  type="text"
                  class="form-control"
                  id="apellido"
                  formControlName="apellido"
                  required
                />
              </div>

              <div class="col-md-6">
                <label for="email" class="form-label">Email *</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  formControlName="email"
                  required
                />
              </div>

              <div class="col-md-6">
                <label for="cedula" class="form-label">Cédula *</label>
                <input
                  type="text"
                  class="form-control"
                  id="cedula"
                  formControlName="cedula"
                  required
                />
              </div>
            </div>
          </section>

          <!-- Información de contacto -->
          <section class="mb-4">
            <h4 class="section-title">
              <i class="bi bi-telephone me-2"></i> Información de Contacto
            </h4>
            <div class="row g-3">
              <div class="col-md-6">
                <label for="telefono" class="form-label">Teléfono</label>
                <input
                  type="tel"
                  class="form-control"
                  id="telefono"
                  formControlName="telefono"
                />
              </div>

              <div class="col-md-6">
                <label for="fotoPerfil" class="form-label"
                  >URL Foto de Perfil</label
                >
                <input
                  type="url"
                  class="form-control"
                  id="fotoPerfil"
                  formControlName="fotoPerfil"
                />
                <small class="form-text"
                  >Deja en blanco para usar avatar por defecto</small
                >
              </div>
            </div>
          </section>

          <!-- Seguridad -->
          <section class="mb-4">
            <h4 class="section-title">
              <i class="bi bi-shield-lock me-2"></i> Cambiar Contraseña
            </h4>
            <div class="alert alert-info">
              <i class="bi bi-info-circle me-2"></i>
              Debes confirmar tu contraseña si quieres que se guarden los
              cambios.
            </div>
            <div class="row g-3">
              <div class="col-md-6">
                <label for="nuevaClave" class="form-label"
                  >Nueva Contraseña</label
                >
                <div class="input-group">
                  <input
                    [type]="mostrarNuevaClave ? 'text' : 'password'"
                    class="form-control"
                    id="nuevaClave"
                    formControlName="nuevaClave"
                    minlength="6"
                  />
                  <button
                    type="button"
                    class="btn btn-outline-secondary"
                    (click)="togglePassword('nueva')"
                  >
                    <i
                      class="bi"
                      [ngClass]="mostrarNuevaClave ? 'bi-eye' : 'bi-eye-slash'"
                    ></i>
                  </button>
                </div>
              </div>

              <div class="col-md-6">
                <label for="confirmarClave" class="form-label"
                  >Confirmar Contraseña</label
                >
                <div class="input-group">
                  <input
                    [type]="mostrarConfirmarClave ? 'text' : 'password'"
                    class="form-control"
                    id="confirmarClave"
                    formControlName="confirmarClave"
                    minlength="6"
                  />
                  <button
                    type="button"
                    class="btn btn-outline-secondary"
                    (click)="togglePassword('confirmar')"
                  >
                    <i
                      class="bi"
                      [ngClass]="
                        mostrarConfirmarClave ? 'bi-eye' : 'bi-eye-slash'
                      "
                    ></i>
                  </button>
                </div>
              </div>
            </div>
          </section>

          <!-- Botones -->
          <div class="d-flex justify-content-between flex-wrap gap-2 mt-4">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="resetForm()"
              [disabled]="!formChanged"
            >
              <i class="bi bi-arrow-clockwise me-1"></i> Restaurar
            </button>

            <div class="d-flex gap-2">
              <button
                type="button"
                class="btn btn-outline-danger"
                (click)="eliminarUsuario()"
              >
                <i class="bi bi-trash me-1"></i> Eliminar
              </button>
              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="!formChanged || perfilForm.invalid"
              >
                <i class="bi bi-check-lg me-1"></i> Guardar cambios
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</main>
