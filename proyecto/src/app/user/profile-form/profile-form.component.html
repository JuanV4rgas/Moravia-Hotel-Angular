<form [formGroup]="perfilForm" (ngSubmit)="onSubmit()" novalidate>
  <!-- Información Personal -->
  <section class="mb-4">
    <h4 class="section-title">
      <i class="bi bi-person me-2"></i> Información Personal
    </h4>
    <div class="row g-3">
      <div class="col-md-6">
        <label for="nombre" class="form-label">Nombres *</label>
        <input
          type="text"
          class="form-control"
          id="nombre"
          formControlName="nombre"
          required
        />
      </div>

      <div class="col-md-6">
        <label for="apellido" class="form-label">Apellidos *</label>
        <input
          type="text"
          class="form-control"
          id="apellido"
          formControlName="apellido"
          required
        />
      </div>

      <div class="col-md-6">
        <label for="email" class="form-label">Email *</label>
        <input
          type="email"
          class="form-control"
          id="email"
          formControlName="email"
          required
        />
      </div>

      <div class="col-md-6">
        <label for="cedula" class="form-label">Cédula *</label>
        <input
          type="text"
          class="form-control"
          id="cedula"
          formControlName="cedula"
          required
        />
      </div>
    </div>
  </section>

  <!-- Información de contacto -->
  <section class="mb-4">
    <h4 class="section-title">
      <i class="bi bi-telephone me-2"></i> Información de Contacto
    </h4>
    <div class="row g-3">
      <div class="col-md-6">
        <label for="telefono" class="form-label">Teléfono</label>
        <input
          type="tel"
          class="form-control"
          id="telefono"
          formControlName="telefono"
        />
      </div>

      <div class="col-md-6">
        <label for="fotoPerfil" class="form-label">URL Foto de Perfil</label>
        <input
          type="url"
          class="form-control"
          id="fotoPerfil"
          formControlName="fotoPerfil"
        />
        <small class="form-text"
          >Deja en blanco para usar avatar por defecto</small
        >
      </div>
    </div>

    <div class="col-md-6">
      <label for="tipo" class="form-label">Tipo de usuario</label>
      <select id="tipo" class="form-control" formControlName="tipo">
        <option value="cliente">Cliente</option>
        <option value="administrador">Administrador</option>
        <option value="operador">Operador</option>
      </select>
    </div>
  </section>

  <!-- Seguridad -->
  <section class="mb-4">
    <h4 class="section-title">
      <i class="bi bi-shield-lock me-2"></i> Cambiar Contraseña
    </h4>
    <div class="row g-3">
      <div class="col-md-6">
        <label for="nuevaClave" class="form-label">Nueva Contraseña</label>
        <div class="input-group">
          <input
            [type]="mostrarNuevaClave ? 'text' : 'password'"
            class="form-control"
            id="nuevaClave"
            formControlName="nuevaClave"
            minlength="8"
          />
          <button
            type="button"
            class="btn btn-outline-secondary"
            (click)="togglePassword('nueva')"
          >
            <i
              class="bi"
              [ngClass]="mostrarNuevaClave ? 'bi-eye' : 'bi-eye-slash'"
            ></i>
          </button>
        </div>
        <div *ngIf="perfilForm.get('nuevaClave')?.hasError('minlength') && perfilForm.get('nuevaClave')?.touched" class="text-danger mt-1">
          La contraseña debe tener al menos 8 caracteres.
        </div>
      </div>

      <div class="col-md-6">
        <label for="confirmarClave" class="form-label"
          >Confirmar Contraseña</label
        >
        <div class="input-group">
          <input
            [type]="mostrarConfirmarClave ? 'text' : 'password'"
            class="form-control"
            id="confirmarClave"
            formControlName="confirmarClave"
            minlength="8"
          />
          <button
            type="button"
            class="btn btn-outline-secondary"
            (click)="togglePassword('confirmar')"
          >
            <i
              class="bi"
              [ngClass]="mostrarConfirmarClave ? 'bi-eye' : 'bi-eye-slash'"
            ></i>
          </button>
        </div>
        <div *ngIf="perfilForm.get('confirmarClave')?.hasError('mismatch')" class="text-danger mt-1">
          Las contraseñas no coinciden.
        </div>
        <div *ngIf="perfilForm.get('confirmarClave')?.hasError('minlength') && perfilForm.get('confirmarClave')?.touched" class="text-danger mt-1">
          La contraseña debe tener al menos 8 caracteres.
        </div>
      </div>
    </div>
  </section>

  <!-- Botones -->
  <div class="d-flex justify-content-between flex-wrap gap-2 mt-4">
    <button
      type="button"
      class="btn btn-secondary"
      (click)="resetForm()"
      [disabled]="!formChanged"
    >
      <i class="bi bi-arrow-clockwise me-1"></i> Restaurar
    </button>

    <div class="d-flex gap-2">
      <button
        type="button"
        class="btn btn-outline-danger"
        (click)="eliminarUsuario()"
      >
        <i class="bi bi-trash me-1"></i> Eliminar
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="!formChanged || perfilForm.invalid"
      >
        <i class="bi bi-check-lg me-1"></i> Guardar cambios
      </button>
    </div>
  </div>
</form>
